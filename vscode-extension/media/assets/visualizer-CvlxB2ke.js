import{u as z,r as c,j as e,S as J,c as L}from"./index-D13IQ1j3.js";const A=()=>{const{mode:P,setMode:R,theme:k}=z(),[h,I]=c.useState(`import Mathlib

theorem add_zero (n : Nat) : n + 0 = n := by
  induction n with
  | zero => rfl
  | succ n ih =>
    simp [Nat.add_succ, ih]`),[M,j]=c.useState("No goals fetched yet."),[o,g]=c.useState([]),[r,p]=c.useState("idle"),[f,N]=c.useState(null),v=async a=>{const s=await a.text();if(!s)return{data:null,raw:s};try{return{data:JSON.parse(s),raw:s}}catch{return{data:null,raw:s}}},$=async()=>{var a,s;p("pending"),N(null),g([]);try{const i=await fetch("/api/lean/session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({})}),y=await v(i),t=y.data;if(!i.ok||!(t!=null&&t.sessionId))throw new Error((t==null?void 0:t.error)??(y.raw||`Failed to create session (status ${i.status}).`));const w=t.sessionId,S="file:///opt/lean-workspace/Visualizer.lean",T=await fetch("/api/lean/session/open",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:w,uri:S,text:h})});if(!T.ok){const n=await T.text();throw new Error(n||"Failed to open document.")}const x=h.split(`
`),C=12,d=[];for(let n=0;n<x.length;n+=1){const b=((a=x[n])==null?void 0:a.trim())??"";if(!b)continue;if(d.length>=C)break;const m=await fetch("/api/lean/session/goals",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:w,uri:S,position:{line:n,character:((s=x[n])==null?void 0:s.length)??0}})}),O=await v(m),l=O.data;if(!m.ok)throw new Error((l==null?void 0:l.error)??(O.raw||`Failed to fetch goals (status ${m.status}).`));const u=l==null?void 0:l.result,G=typeof u=="string"?u:JSON.stringify(u??"No goal state",null,2);d.push({line:n+1,text:G,source:b})}const E=d.at(-1);j(E?E.text:"No goals fetched yet."),g(d),p("ready")}catch(i){p("error"),N(i instanceof Error?i.message:"Request failed.")}};return e.jsxs("div",{className:`page theme-${k}`,children:[e.jsx(J,{mode:P,onModeChange:R}),e.jsxs("section",{className:"intro",children:[e.jsx("h1",{children:"TR-003 · Proof Visualizer"}),e.jsx("p",{children:"Static scaffold for goal-state graphs, tactic timelines, and dependency views."})]}),e.jsxs("section",{className:"samples",children:[e.jsx("div",{className:"panel-header",children:e.jsxs("div",{children:[e.jsx("h2",{children:"Section A · Visual output"}),e.jsx("p",{children:"Mock layout showing where tactics and goals will surface."})]})}),e.jsxs("div",{className:"panel",children:[e.jsxs("div",{className:"panel-header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:"Input · Lean source"}),e.jsx("p",{children:"Paste a Lean proof and request goal snapshots."})]}),e.jsx("span",{className:`status-chip ${r}`,children:r==="ready"?"READY":r==="pending"?"PENDING":r==="error"?"ERROR":"IDLE"})]}),e.jsx("textarea",{className:"code-input",spellCheck:!1,value:h,onChange:a=>I(a.target.value)}),e.jsx("div",{className:"panel-actions",children:e.jsx("button",{type:"button",className:"primary-button",onClick:$,disabled:r==="pending",children:"Fetch goal snapshot"})}),r==="error"&&f?e.jsxs("p",{className:"placeholder",children:["Error: ",f]}):null]}),e.jsxs("div",{className:"visualizer-grid",children:[e.jsxs("div",{className:"panel",children:[e.jsx("div",{className:"panel-header",children:e.jsxs("div",{children:[e.jsx("h2",{children:"Track · Tactic stream"}),e.jsx("p",{children:"Stepwise tactic sequence extracted from the proof."})]})}),e.jsx("ol",{className:"tactic-list",children:(o.length>0?o:[{line:1,source:"Waiting..."}]).map((a,s)=>e.jsxs("li",{children:["L",a.line,": ",a.source??"Waiting..."]},`${a.line}-${s}`))})]}),e.jsxs("div",{className:"panel",children:[e.jsx("div",{className:"panel-header",children:e.jsxs("div",{children:[e.jsx("h2",{children:"Track · Goal states"}),e.jsx("p",{children:"Before/after snapshots of the active goal."})]})}),e.jsx("div",{className:"goal-flow",children:o.length>0?o.map((a,s)=>e.jsxs("div",{children:[e.jsxs("div",{className:"goal-card",children:[e.jsxs("p",{className:"meta-label",children:["GOAL ",s]}),e.jsx("pre",{children:a.text})]}),s<o.length-1?e.jsx("div",{className:"goal-arrow",children:"↓"}):null]},`${a.line}-${s}`)):e.jsxs("div",{className:"goal-card",children:[e.jsx("p",{className:"meta-label",children:"GOAL"}),e.jsx("pre",{children:M})]})})]})]}),e.jsxs("div",{className:"panel",children:[e.jsx("div",{className:"panel-header",children:e.jsxs("div",{children:[e.jsx("h2",{children:"Section B · Dependency map"}),e.jsx("p",{children:"Placeholder for lemma graph and rewrite edges."})]})}),e.jsxs("div",{className:"dependency-grid",children:[e.jsx("div",{className:"dependency-node",children:"Nat.add_succ"}),e.jsx("div",{className:"dependency-node",children:"ih"}),e.jsx("div",{className:"dependency-node",children:"simp"}),e.jsx("div",{className:"dependency-node",children:"rfl"})]})]})]})]})};L(document.getElementById("root")).render(e.jsx(c.StrictMode,{children:e.jsx(A,{})}));
